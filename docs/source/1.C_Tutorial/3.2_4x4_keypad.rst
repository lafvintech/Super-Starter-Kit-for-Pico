3.2 4x4 Keypad
=========================
The 4x4 keyboard, often referred to as a matrix keyboard, consists of a grid of 16 
keys arranged in a single panel. This type of keypad is commonly found on devices 
that primarily require numeric input, such as calculators, TV remotes, push-button 
phones, vending machines, ATMs, combination locks, and digital door locks.

In this project, we will explore how to detect which key is pressed and retrieve 
the corresponding key value.

Component List
^^^^^^^^^^^^^^^
- Raspberry Pi Pico W x1
- MicroUSB cable x1
- 830 Tie-Points Breadboard x1
- Resistor 10KΩ x4
- 4x4 Keypad x1
- Jumper Wire Several

Component knowledge
^^^^^^^^^^^^^^^^^^^^
:ref:`4x4 Keypad <cpn_keypad>`
"""""""""""""""""""""""""""""""""""

Schematic
^^^^^^^^^^
.. image:: img/2.sch/3.2.png

Each column of the matrix keyboard is connected to a pull-down resistor, ensuring 
that G6 to G9 remain at a stable low level when no keys are pressed. The rows of 
the keyboard (G2 to G5) are programmed to output a high signal. If any of G6 to 
G9 is detected as high, it indicates that a specific key has been pressed.

For instance, if G6 is read as high, it means that the numeric key 1 has been 
pressed. This is because the control pins for numeric key 1 are G2 and G6. When 
key 1 is pressed, G2 and G6 are connected, causing G6 to go high.

Connect
^^^^^^^^^
.. image:: img/3.connect/3.2.png

To make the wiring easier, in the above diagram, the column row of the matrix keyboard and the 10K resistors are inserted into the holes where G6 ~ G9 are located at the same time.

Code
^^^^^^^
.. note::

    * Open the ``3.2_4x4_keypad.ino`` file under the path of ``Ultimate-Starter-Kit-for-Pico\Arduino\1.Project`` or copy this code into Thonny, then click "Run Current Script" or simply press F5 to run it.

    * Or copy this code into Arduino IDE.

    * Don’t forget to select the board(Raspberry Pi Pico) and the correct port before clicking the Upload button. 

.. image:: img/4.software/3.2.png

Click “Run current script”, the Shell will print out the keys you pressed on the Keypad.

The following is the program code:

.. code-block:: c++

    // Include the Adafruit_Keypad library
    #include "Adafruit_Keypad.h"

    // Define the number of rows and columns for the keypad
    const byte ROWS = 4;
    const byte COLS = 4;

    // Define the characters mapped to each button on the 4x4 keypad
    char keys[ROWS][COLS] = {
    { '1', '2', '3', 'A' },
    { '4', '5', '6', 'B' },
    { '7', '8', '9', 'C' },
    { '*', '0', '#', 'D' }
    };

    // Define the Arduino pins connected to the row pinouts of the keypad
    byte rowPins[ROWS] = { 2, 3, 4, 5 };
    // Define the Arduino pins connected to the column pinouts of the keypad
    byte colPins[COLS] = { 6, 7, 8, 9 };

    // Initialize a custom keypad instance
    Adafruit_Keypad myKeypad = Adafruit_Keypad(makeKeymap(keys), rowPins, colPins, ROWS, COLS);

    // Setup function
    void setup() {
    // Initialize Serial communication at 9600 baud rate
    Serial.begin(9600);
    // Initialize the custom keypad
    myKeypad.begin();
    }

    // Main loop function
    void loop() {
    // Update the state of keys
    myKeypad.tick();

    // Check if there are new keypad events
    while (myKeypad.available()) {
        // Read the keypad event
        keypadEvent e = myKeypad.read();
        // Print the key that triggered the event
        Serial.print((char)e.bit.KEY);
        // Print the type of event: pressed or released
        if (e.bit.EVENT == KEY_JUST_PRESSED) Serial.println(" pressed");
        else if (e.bit.EVENT == KEY_JUST_RELEASED) Serial.println(" released");
    }

    delay(10);
    }

Phenomenon
^^^^^^^^^^^
.. image:: img/5.phenomenon/3.2.png
    :width: 100%