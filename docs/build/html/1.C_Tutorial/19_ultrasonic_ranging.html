<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chapter 19 Ultrasonic Ranging &mdash; Super-Starter-Kit-for-ESP32-S3-WROOM  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Chapter 20 Bluetooth" href="20_bluetooth.html" />
    <link rel="prev" title="Chapter 18 LCD1602" href="18_lcd1602.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html">
            
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../about_this_kit.html">About This Kit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../component_list.html">Component List</a></li>
<li class="toctree-l1"><a class="reference internal" href="../preparation/preparation.html">Preparation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="c_tutorial.html">C Language Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="C_preparation.html">C Language Preparation</a></li>
<li class="toctree-l2"><a class="reference internal" href="0_led.html">Chapter 0 LED</a></li>
<li class="toctree-l2"><a class="reference internal" href="1_led.html">Chapter 1 LED</a></li>
<li class="toctree-l2"><a class="reference internal" href="2_btn%26led.html">Chapter 2 Button &amp; LED</a></li>
<li class="toctree-l2"><a class="reference internal" href="3_led_bar.html">Chapter 3 LED Bar</a></li>
<li class="toctree-l2"><a class="reference internal" href="4_analog%26pwm.html">Chapter 4 Analog &amp; PWM</a></li>
<li class="toctree-l2"><a class="reference internal" href="5_rgb_led.html">Chapter 5 RGB LED</a></li>
<li class="toctree-l2"><a class="reference internal" href="6_buzzer.html">Chapter 6 Buzzer</a></li>
<li class="toctree-l2"><a class="reference internal" href="7_serial_communication.html">Chapter 7 Serial Communication</a></li>
<li class="toctree-l2"><a class="reference internal" href="8_ad_converter.html">Chapter 8 AD Converter</a></li>
<li class="toctree-l2"><a class="reference internal" href="9_touch_sensor.html">Chapter 9 Touch Sensor</a></li>
<li class="toctree-l2"><a class="reference internal" href="10_potentiometer.html">Chapter 10 Potentiometer &amp; LED</a></li>
<li class="toctree-l2"><a class="reference internal" href="11_photoresistor.html">Chapter 11 Photoresistor &amp; LED</a></li>
<li class="toctree-l2"><a class="reference internal" href="12_thermistor.html">Chapter 12 Thermistor</a></li>
<li class="toctree-l2"><a class="reference internal" href="13_joystick.html">Chapter 13 Joystick</a></li>
<li class="toctree-l2"><a class="reference internal" href="14_74HC595%26led_bar_graph.html">Chapter 14 74HC595 &amp; LED Bar Graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="15_74HC595%267-segment_display.html">Chapter 15 74HC595 &amp; 7-Segment Display</a></li>
<li class="toctree-l2"><a class="reference internal" href="16_relay%26motor.html">Chapter 16 Relay &amp; Motor</a></li>
<li class="toctree-l2"><a class="reference internal" href="17_servo.html">Chapter 17 Servo</a></li>
<li class="toctree-l2"><a class="reference internal" href="18_lcd1602.html">Chapter 18 LCD1602</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Chapter 19 Ultrasonic Ranging</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#project-19-1-ultrasonic-ranging">Project 19.1 Ultrasonic Ranging</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#component-list">Component List</a></li>
<li class="toctree-l4"><a class="reference internal" href="#connect">Connect</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sketch">Sketch</a></li>
<li class="toctree-l4"><a class="reference internal" href="#code">Code</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#project-19-2-ultrasonic-ranging">Project 19.2 Ultrasonic Ranging</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#component-list-and-connect">Component List and Connect</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id1">Sketch</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id2">Code</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="20_bluetooth.html">Chapter 20 Bluetooth</a></li>
<li class="toctree-l2"><a class="reference internal" href="21_read_and_write_the_sdcard.html">Chapter 21 Read and Write the SDcard</a></li>
<li class="toctree-l2"><a class="reference internal" href="22_play_sd_card_music.html">Chapter 22 Play SD card music</a></li>
<li class="toctree-l2"><a class="reference internal" href="23_wifi_working_modes.html">Chapter 23 WiFi Working Modes</a></li>
<li class="toctree-l2"><a class="reference internal" href="24_tcpip.html">Chapter 24 TCP/IP</a></li>
<li class="toctree-l2"><a class="reference internal" href="25_camera_web_server.html">Chapter 25 Camera Web Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="26_camera_tcp_server.html">Chapter 26 Camera Tcp Server</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../2.Python_Tutorial/python_tutorial.html">Python Language Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../components_Kit/Components_Kit.html">Components Introduction</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Super-Starter-Kit-for-ESP32-S3-WROOM</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="c_tutorial.html">C Language Tutorial</a></li>
      <li class="breadcrumb-item active">Chapter 19 Ultrasonic Ranging</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/1.C_Tutorial/19_ultrasonic_ranging.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="chapter-19-ultrasonic-ranging">
<h1>Chapter 19 Ultrasonic Ranging<a class="headerlink" href="#chapter-19-ultrasonic-ranging" title="Link to this heading"></a></h1>
<p>In this chapter, we learn a module which use ultrasonic to measure distance, HC-SR04.</p>
<section id="project-19-1-ultrasonic-ranging">
<h2>Project 19.1 Ultrasonic Ranging<a class="headerlink" href="#project-19-1-ultrasonic-ranging" title="Link to this heading"></a></h2>
<p>In this project, we use ultrasonic ranging module to measure distance, and print
out the data in the terminal.</p>
<section id="component-list">
<h3>Component List<a class="headerlink" href="#component-list" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Raspberry Pi Pico W x1</p></li>
<li><p>830 Tie-Points Breadboard x1</p></li>
<li><p>Ultrasonic Sensor x1</p></li>
<li><p>F-M DuPont Cable x4</p></li>
</ul>
</section>
<section id="connect">
<h3>Connect<a class="headerlink" href="#connect" title="Link to this heading"></a></h3>
<p>Note that the voltage of ultrasonic module is 5V in the circuit.</p>
<img alt="1.C_Tutorial/img/3.connect/19.png" src="1.C_Tutorial/img/3.connect/19.png" />
</section>
<section id="sketch">
<h3>Sketch<a class="headerlink" href="#sketch" title="Link to this heading"></a></h3>
<p><strong>Sketch_19.1_Ultrasonic_Ranging</strong></p>
<img alt="1.C_Tutorial/img/4.software/19.1.png" src="1.C_Tutorial/img/4.software/19.1.png" />
<p>Download the code to ESP32-S3 WROOM, open the serial port monitor, set the baud
rate to 115200 and you can use it to measure the distance between the ultrasonic
module and the object. As shown in the following figure:</p>
<img alt="../_images/19.1.png" src="../_images/19.1.png" />
</section>
<section id="code">
<h3>Code<a class="headerlink" href="#code" title="Link to this heading"></a></h3>
<p>The following is the program code:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#define trigPin 13 </span><span class="c1">// define TrigPin</span>
<span class="cp">#define echoPin 14 </span><span class="c1">// define EchoPin.</span>
<span class="cp">#define MAX_DISTANCE 700 </span><span class="c1">// Maximum sensor distance is rated at 400-500cm.</span>
<span class="c1">//timeOut= 2*MAX_DISTANCE /100 /340 *1000000 = MAX_DISTANCE*58.8</span>
<span class="kt">float</span><span class="w"> </span><span class="n">timeOut</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MAX_DISTANCE</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">60</span><span class="p">;</span>
<span class="kt">int</span><span class="w"> </span><span class="n">soundVelocity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">340</span><span class="p">;</span><span class="w"> </span><span class="c1">// define sound speed=340m/s</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">setup</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="n">pinMode</span><span class="p">(</span><span class="n">trigPin</span><span class="p">,</span><span class="n">OUTPUT</span><span class="p">);</span><span class="c1">// set trigPin to output mode</span>
<span class="n">pinMode</span><span class="p">(</span><span class="n">echoPin</span><span class="p">,</span><span class="n">INPUT</span><span class="p">);</span><span class="w"> </span><span class="c1">// set echoPin to input mode</span>
<span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span><span class="w">   </span><span class="c1">// Open serial monitor at 115200 baud to see ping results.</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">loop</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span><span class="w"> </span><span class="c1">// Wait 100ms between pings (about 20 pings/sec).</span>
<span class="n">Serial</span><span class="p">.</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Distance: &quot;</span><span class="p">);</span>
<span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">getSonar</span><span class="p">());</span><span class="w"> </span><span class="c1">// Send ping, get distance in cm and print result</span>
<span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;cm&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">float</span><span class="w"> </span><span class="nf">getSonar</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">pingTime</span><span class="p">;</span>
<span class="kt">float</span><span class="w"> </span><span class="n">distance</span><span class="p">;</span>
<span class="c1">// make trigPin output high level lasting for 10μs to triger HC_SR04</span>
<span class="n">digitalWrite</span><span class="p">(</span><span class="n">trigPin</span><span class="p">,</span><span class="w"> </span><span class="n">HIGH</span><span class="p">);</span>
<span class="n">delayMicroseconds</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
<span class="n">digitalWrite</span><span class="p">(</span><span class="n">trigPin</span><span class="p">,</span><span class="w"> </span><span class="n">LOW</span><span class="p">);</span>
<span class="c1">// Wait HC-SR04 returning to the high level and measure out this waitting time</span>
<span class="n">pingTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pulseIn</span><span class="p">(</span><span class="n">echoPin</span><span class="p">,</span><span class="w"> </span><span class="n">HIGH</span><span class="p">,</span><span class="w"> </span><span class="n">timeOut</span><span class="p">);</span>
<span class="c1">// calculate the distance according to the time</span>
<span class="n">distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">pingTime</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">soundVelocity</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">10000</span><span class="p">;</span>
<span class="k">return</span><span class="w"> </span><span class="n">distance</span><span class="p">;</span><span class="w"> </span><span class="c1">// return the distance value</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="project-19-2-ultrasonic-ranging">
<h2>Project 19.2 Ultrasonic Ranging<a class="headerlink" href="#project-19-2-ultrasonic-ranging" title="Link to this heading"></a></h2>
<section id="component-list-and-connect">
<h3>Component List and Connect<a class="headerlink" href="#component-list-and-connect" title="Link to this heading"></a></h3>
<p>Component List and Connect are the same as the previous section</p>
</section>
<section id="id1">
<h3>Sketch<a class="headerlink" href="#id1" title="Link to this heading"></a></h3>
<p><strong>How to install the library</strong></p>
<p>We use the third party library UltrasonicSensor. If you haven’t installed it yet,
please do so before learning. The steps to add third-party Libraries are as follow
s: open arduino-&gt;Sketch-&gt;Include library-&gt; Manage libraries. Enter “UltrasonicSensor”
in the search bar and select “UltrasonicSensor” for installation.
Refer to the following operations:</p>
<img alt="../_images/19.2_lib.png" src="../_images/19.2_lib.png" />
<p><strong>Sketch_19.2_Ultrasonic_Ranging</strong></p>
<img alt="1.C_Tutorial/img/4.software/19.2.png" src="1.C_Tutorial/img/4.software/19.2.png" />
<p>Download the code to ESP32-S3 WROOM, open the serial port monitor, set the baud
rate to 115200. Use the ultrasonic module to measure distance. As shown in the
following figure:</p>
<img alt="../_images/19.2.png" src="../_images/19.2.png" />
</section>
<section id="id2">
<h3>Code<a class="headerlink" href="#id2" title="Link to this heading"></a></h3>
<p>The following is the program code:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;UltrasonicSensor.h&gt;</span>

<span class="n">UltrasonicSensor</span><span class="w"> </span><span class="nf">ultrasonic</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="p">);</span><span class="w">  </span><span class="c1">// Create ultrasonic sensor object, using pins 13 and 14</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">setup</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span><span class="w">  </span><span class="c1">// Initialize serial communication at 115200 baud</span>

<span class="kt">int</span><span class="w"> </span><span class="n">temperature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">22</span><span class="p">;</span><span class="w">  </span><span class="c1">// Set ambient temperature (in Celsius)</span>
<span class="n">ultrasonic</span><span class="p">.</span><span class="n">setTemperature</span><span class="p">(</span><span class="n">temperature</span><span class="p">);</span><span class="w">  </span><span class="c1">// Calibrate sensor for the set temperature</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">loop</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="kt">int</span><span class="w"> </span><span class="n">distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ultrasonic</span><span class="p">.</span><span class="n">distanceInCentimeters</span><span class="p">();</span><span class="w">  </span><span class="c1">// Measure distance in centimeters</span>
<span class="n">Serial</span><span class="p">.</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Distance: %dcm</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">distance</span><span class="p">);</span><span class="w">  </span><span class="c1">// Print the measured distance</span>
<span class="n">delay</span><span class="p">(</span><span class="mi">300</span><span class="p">);</span><span class="w">  </span><span class="c1">// Wait for 300 milliseconds before next measurement</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="18_lcd1602.html" class="btn btn-neutral float-left" title="Chapter 18 LCD1602" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="20_bluetooth.html" class="btn btn-neutral float-right" title="Chapter 20 Bluetooth" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Lafvin.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>